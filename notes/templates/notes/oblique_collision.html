<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>‚öõ Oblique Collision Simulation </title>
<style>
  html, body {
    margin: 0;
    height: 100%;
    background: #000000ff;
    color: #fff;
    font-family: Poppins, sans-serif;
    display: flex;
    flex-direction: column;
  }

  h1 {
    text-align: center;
    color: #00eaff;
    margin-top: 10px;
    text-shadow: 0 0 10px #00eaff;
  }

  .controls {
    text-align: center;
    margin: 10px 0;
    color: #00eaff;
  }

  canvas {
    flex-grow: 1;
    display: block;
    margin: 0 auto;
    background: #111111ff;
    border: 2px solid #00eaff;
    border-radius: 10px;
    max-width: 95vw;
    height: auto;
  }

  input[type="number"] {
    width: 85px;
    text-align: center;
    background: #021a33;
    color: #00eaff;
    border: none;
    border-radius: 5px;
    padding: 6px;
    font-size: 15px;
    margin: 3px;
  }

  input[type="range"] {
    width: 200px;
    accent-color: #00eaff;
  }

  button {
    background: #00eaff;
    border: none;
    border-radius: 5px;
    padding: 8px 14px;
    color: #000;
    font-weight: bold;
    cursor: pointer;
    margin: 4px;
  }

  button:hover { background: #0099cc; }

  .data-container {
    background: #021a33;
    border-top: 1px solid #00eaff44;
    padding: 12px 0;
    text-align: center;
    font-size: 20px;
    flex-shrink: 0;
  }

  .val {
    color: #fff;
    font-weight: bold;
  }

  .formula {
    background: #010f1f;
    color: #ccc;
    padding: 10px;
    border-top: 1px solid #00eaff44;
    text-align: center;
    flex-shrink: 0;
  }

  .bottom-section {
    overflow-y: auto;
    max-height: 25vh;
  }

  .zoom-controls {
    text-align: center;
    margin-top: 8px;
  }

  .zoom-controls button {
    width: 35px;
    height: 35px;
    font-size: 22px;
    border-radius: 50%;
    padding: 0;
  }
</style>
</head>
<body>

<h1>‚öõ Oblique Collision Simulation </h1>

<div class="controls">
  <label>m‚ÇÅ: <input id="m1" value="2" type="number"></label>
  <label>v‚ÇÅ: <input id="v1" value="5" type="number"></label>
  <label>Œ∏‚ÇÅ: <input id="a1" value="30" type="number"></label>
  <label>x‚ÇÅ: <input id="x1" value="300" type="number"></label>
  <label>y‚ÇÅ: <input id="y1" value="400" type="number"></label><br>

  <label>m‚ÇÇ: <input id="m2" value="3" type="number"></label>
  <label>v‚ÇÇ: <input id="v2" value="4" type="number"></label>
  <label>Œ∏‚ÇÇ: <input id="a2" value="150" type="number"></label>
  <label>x‚ÇÇ: <input id="x2" value="900" type="number"></label>
  <label>y‚ÇÇ: <input id="y2" value="400" type="number"></label><br>

  <label>e (COR): <input id="eSlider" type="range" min="0" max="1" step="0.05" value="1" oninput="updateE()">
  <span id="eVal">1.00</span></label>

  <label>Speed: <input id="speedSlider" type="range" min="0.2" max="2" step="0.1" value="1" oninput="updateSpeed()">
  <span id="speedVal">1x</span></label><br>

  <button onclick="start()">‚ñ∂ Start</button>
  <button onclick="togglePause()">‚è∏ Pause</button>
  <button onclick="reset()">‚ü≥ Reset</button>
  <button onclick="replay()">üîÅ Replay</button>
</div>

<div class="zoom-controls">
  <button onclick="zoomIn()">+</button>
  <button onclick="zoomOut()">‚àí</button>
</div>

<canvas id="canvas" width="1400" height="700"></canvas>

<div class="bottom-section">
  <div class="data-container">
    ‚ö° ŒîKE‚ÇÅ: <span class="val" id="keA">0%</span>‚ÄÉ|‚ÄÉ
    ‚ö° ŒîKE‚ÇÇ: <span class="val" id="keB">0%</span>‚ÄÉ|‚ÄÉ
    ‚ö° Total KE Loss: <span class="val" id="keLoss">0%</span>‚ÄÉ||‚ÄÉ
    üß≠ v‚Çì‚ÇÅ: <span class="val" id="vx1">0.00</span>‚ÄÉv·µß‚ÇÅ: <span class="val" id="vy1">0.00</span>‚ÄÉ|‚ÄÉ
    üß≠ v‚Çì‚ÇÇ: <span class="val" id="vx2">0.00</span>‚ÄÉv·µß‚ÇÇ: <span class="val" id="vy2">0.00</span>
  </div>

  <div class="formula">
    <b>Formulas:</b><br>
    KE = ¬Ω m v¬≤‚ÄÉ|‚ÄÉe = (v‚ÇÇ' ‚àí v‚ÇÅ') / (v‚ÇÅ ‚àí v‚ÇÇ)‚ÄÉ|‚ÄÉŒ∏ = tan‚Åª¬π(vy / vx)
  </div>
</div>

<script>
const c=document.getElementById("canvas"),ctx=c.getContext("2d");
let zoomLevel=1,zoomStep=0.1,maxZoom=2,minZoom=0.5;
let A={x:300,y:400,vx:0,vy:0,m:2,r:25,color:"#00eaff"},
    B={x:900,y:400,vx:0,vy:0,m:3,r:25,color:"#ff5050"};
let running=false,paused=false,collisionDone=false,e=1,speedFactor=1,flashTimer=0;
let KE_before={A:0,B:0,total:0};

function updateE(){ e=parseFloat(eSlider.value); eVal.textContent=e.toFixed(2);}
function updateSpeed(){ speedFactor=parseFloat(speedSlider.value); speedVal.textContent=speedFactor.toFixed(1)+"x";}

function zoomIn(){ if(zoomLevel<maxZoom){ zoomLevel+=zoomStep; } }
function zoomOut(){ if(zoomLevel>minZoom){ zoomLevel-=zoomStep; } }

function drawBall(b,label){
  ctx.beginPath(); ctx.arc(b.x,b.y,b.r,0,2*Math.PI); ctx.fillStyle=b.color; ctx.fill();
  ctx.beginPath(); ctx.moveTo(b.x,b.y); ctx.lineTo(b.x+b.vx*10,b.y+b.vy*10);
  ctx.strokeStyle=b.color; ctx.lineWidth=2; ctx.stroke();
  ctx.font="bold 16px Poppins"; ctx.fillStyle="#fff";
  const offX=(label==="A"?-80:40), offY=-40;
  const v=Math.hypot(b.vx,b.vy).toFixed(2),ang=(Math.atan2(b.vy,b.vx)*180/Math.PI).toFixed(1);
  ctx.fillText(`${label}: v=${v} m/s`,b.x+offX,b.y+offY);
  ctx.fillText(`Œ∏=${ang}¬∞`,b.x+offX,b.y+offY+18);
}

function drawCenterLine(){
  ctx.beginPath();
  ctx.moveTo(A.x,A.y);
  ctx.lineTo(B.x,B.y);
  ctx.setLineDash([5,5]);
  ctx.strokeStyle="#888";
  ctx.stroke();
  ctx.setLineDash([]);
}

function detect(){ return Math.hypot(B.x-A.x,B.y-A.y)<=A.r+B.r; }

function resolve(){
  const dx=B.x-A.x,dy=B.y-A.y,dist=Math.hypot(dx,dy),nx=dx/dist,ny=dy/dist,tx=-ny,ty=nx;
  const dpTanA=A.vx*tx+A.vy*ty,dpTanB=B.vx*tx+B.vy*ty,dpNormA=A.vx*nx+A.vy*ny,dpNormB=B.vx*nx+B.vy*ny;
  const m1=A.m,m2=B.m;
  const newNormA=(dpNormA*(m1-e*m2)+(1+e)*m2*dpNormB)/(m1+m2);
  const newNormB=(dpNormB*(m2-e*m1)+(1+e)*m1*dpNormA)/(m1+m2);
  A.vx=tx*dpTanA+nx*newNormA; A.vy=ty*dpTanA+ny*newNormA;
  B.vx=tx*dpTanB+nx*newNormB; B.vy=ty*dpTanB+ny*newNormB;
  collisionDone=true; flashTimer=25;
}

function kinetic(b){ return 0.5*b.m*(b.vx*b.vx+b.vy*b.vy);}
function handleBoundaries(b){
  if(b.x-b.r<0){b.x=b.r;b.vx*=-1;}
  if(b.x+b.r>c.width){b.x=c.width-b.r;b.vx*=-1;}
  if(b.y-b.r<0){b.y=b.r;b.vy*=-1;}
  if(b.y+b.r>c.height){b.y=c.height-b.r;b.vy*=-1;}
}

function updateData(){
  const KE_A_after=kinetic(A),KE_B_after=kinetic(B),total_after=KE_A_after+KE_B_after;
  const tot=((1-total_after/KE_before.total)*100).toFixed(2);
  const la=((1-KE_A_after/KE_before.A)*100).toFixed(2);
  const lb=((1-KE_B_after/KE_before.B)*100).toFixed(2);
  keA.textContent=(isNaN(la)?"0":la)+"%";
  keB.textContent=(isNaN(lb)?"0":lb)+"%";
  keLoss.textContent=(isNaN(tot)?"0":tot)+"%";
  vx1.textContent=A.vx.toFixed(2); vy1.textContent=A.vy.toFixed(2);
  vx2.textContent=B.vx.toFixed(2); vy2.textContent=B.vy.toFixed(2);
}

function animate(){
  if(!running)return;
  ctx.clearRect(0,0,c.width,c.height);
  ctx.save();
  ctx.translate(c.width/2,c.height/2);
  ctx.scale(zoomLevel,zoomLevel);
  ctx.translate(-c.width/2,-c.height/2);
  drawCenterLine();
  drawBall(A,"A"); drawBall(B,"B");
  ctx.restore();
  if(!paused){
    A.x+=A.vx*speedFactor; A.y+=A.vy*speedFactor;
    B.x+=B.vx*speedFactor; B.y+=B.vy*speedFactor;
    handleBoundaries(A); handleBoundaries(B);
    if(!collisionDone&&detect())resolve();
  }
  updateData();
  requestAnimationFrame(animate);
}

function start(){
  A.m=parseFloat(m1.value); B.m=parseFloat(m2.value);
  A.x=parseFloat(x1.value); A.y=parseFloat(y1.value);
  B.x=parseFloat(x2.value); B.y=parseFloat(y2.value);
  const v1n=parseFloat(v1.value),v2n=parseFloat(v2.value);
  const a1r=parseFloat(a1.value)*Math.PI/180,a2r=parseFloat(a2.value)*Math.PI/180;
  A.vx=v1n*Math.cos(a1r); A.vy=-v1n*Math.sin(a1r);
  B.vx=v2n*Math.cos(a2r); B.vy=-v2n*Math.sin(a2r);
  KE_before.A=kinetic(A); KE_before.B=kinetic(B); KE_before.total=KE_before.A+KE_before.B;
  running=true; paused=false; collisionDone=false;
  updateData(); animate();
}

function togglePause(){ paused=!paused; }
function reset(){
  running=false; paused=false; collisionDone=false;
  A.x=parseFloat(x1.value); A.y=parseFloat(y1.value);
  B.x=parseFloat(x2.value); B.y=parseFloat(y2.value);
  A.vx=A.vy=B.vx=B.vy=0;
  ctx.clearRect(0,0,c.width,c.height);
  drawCenterLine(); drawBall(A,"A"); drawBall(B,"B");
  updateData();
}
function replay(){ reset(); setTimeout(start, 300);}
reset();
</script>
</body>
</html>
